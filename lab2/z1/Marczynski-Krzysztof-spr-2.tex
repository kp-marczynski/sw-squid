\documentclass{article}
\usepackage[utf8]{inputenc}
\usepackage{polski}
\usepackage{indentfirst}
\usepackage{graphicx}
\usepackage[hidelinks]{hyperref}
\usepackage{float}
\usepackage[margin=1in]{geometry}
\usepackage{titlesec}
\usepackage{csquotes}
\usepackage{todonotes}
\usepackage{listings}
\sloppy

\lstset
{
    numbers=left,
    stepnumber=1,
    showstringspaces=false,
    tabsize=1,
    breaklines=true,
    breakatwhitespace=false,
    frame = single,
}

\titlespacing*{\section}
{0pt}{5.5ex}{4.3ex}
\titlespacing*{\subsection}
{0pt}{5.5ex}{4.3ex}

\title{Systemy webowe\item{SQUID - ACL}}

\author{
\rule[40pt]{0pt}{0pt}
  Krzysztof Marczyński\\
  \texttt{226258}
}

\date{\rule[40pt]{0pt}{0pt} 23.11.2019}

\begin{document}

\maketitle

\newpage

\tableofcontents

\newpage
\section{Wprowadzenie}
Celem zadania jest przygotowanie filtrów dla środowiska squid z uwzględnieniem następujących reguł:

\begin{itemize}
    \item Prezes
    \begin{itemize}
        \item Korzysta z komputerów o adresach MAC 0800278424BF i 080027810873.
        \item Nie ma żadnych ograniczeń odnośnie korzystania z sieci.
    \end{itemize}
    \item Menadżerowie
    \begin{itemize}
        \item Korzystają z komputerów o adresach MAC 080027E7D537, 0800278259C5, 080027C3BEB8.
        \item Nie mają dostępu do stron rozrywkowych w czasie pracy.
        \item Nie mają dostępu do stron rozrywkowych w weekendy.
    \end{itemize}
    \item Projektanci
    \begin{itemize}
        \item Korzystają z komputerów w podsieci 192.168.2.0.
        \item Muszą się logować w celu odróżnienia od Programistów.
        \item Nie mają dostępu do stron rozrywkowych przez cały czas.
        \item Nie mogą pobierać plików multimedialnych.
        \item Nie mogą pobierać programów z wyłączeniem uaktualnień systemu Windows.
    \end{itemize}
    \item Programiści
    \begin{itemize}
        \item Korzystają z komputerów w podsieci 192.168.2.0.
        \item Muszą się logować w celu odróżnienia od Projektantów.
        \item Nie mają dostępu do stron rozrywkowych przez cały czas.
        \item Nie mają dostępu do stron prasowych w czasie pracy.
    \end{itemize}
    \item Administrator
    \begin{itemize}
        \item Korzystaja z komputera o adresie MAC 080027EBD794.
        \item Nie ma żadnych ograniczeń w czasie pracy.
        \item Nie ma dostępu do stron rozrywkowych poza czasem pracy.
    \end{itemize}
    \item Sekretarka i Księgowa
    \begin{itemize}
        \item Korzystają z komputerów w podsieci 192.168.3.0.
        \item Nie mają dostępu do stron rozrywkowych w godzinach pracy.
        \item Mogą pobierać tylko pliki związane z pracą biurową.
    \end{itemize}
\end{itemize}

\section{Pliki ACL}
\subsection{Użytkownicy - adresy MAC}
\lstinputlisting[caption=ACL - users/boss.acl]{proxy/acl/users/boss.acl}
\lstinputlisting[caption=ACL - users/managers.acl]{proxy/acl/users/managers.acl}
\lstinputlisting[caption=ACL - users/admin.acl]{proxy/acl/users/admin.acl}

\subsection{Podsieci}
\lstinputlisting[caption=ACL - nets/devs\_designers\_net.acl]{proxy/acl/nets/devs_designers_net.acl}
\lstinputlisting[caption=ACL - nets/office\_workers\_net.acl]{proxy/acl/nets/office_workers_net.acl}

\subsection{Użytkownicy - konta użytkowników}
\lstinputlisting[caption=ACL - users/developers.acl]{proxy/acl/users/developers.acl}
\lstinputlisting[caption=ACL - users/designers.acl]{proxy/acl/users/designers.acl}

\subsection{Strony internetowe}
\lstinputlisting[caption=ACL - sites/entertainment.acl]{proxy/acl/sites/entertainment.acl}
\lstinputlisting[caption=ACL - sites/news.acl]{proxy/acl/sites/news.acl}
\lstinputlisting[caption=ACL - sites/windows\_updates.acl]{proxy/acl/sites/windows_updates.acl}

\subsection{Rozszerzenia plików}
\lstinputlisting[caption=ACL - files/apps.acl]{proxy/acl/files/apps.acl}
\lstinputlisting[caption=ACL - files/media.acl]{proxy/acl/files/media.acl}
\lstinputlisting[caption=ACL - files/office.acl]{proxy/acl/files/office.acl}
\lstinputlisting[caption=ACL - files/windows\_update.acl]{proxy/acl/files/windows_update.acl}

\section{squid.conf}
\begin{lstlisting}[caption=Zmiany w pliku squid.conf \label{lst:squid-conf}]
##### Authentication setup #####
# point to file with users and passwords
auth_param basic program /usr/lib/squid/basic_ncsa_auth /etc/squid/passwd
# max number of sessions
auth_param basic children 2
# inform web browser about required authentication
auth_param basic realm Serwer squid
# max session time
auth_param basic credentialsttl 2 hours

##### CUSTOM ACL #####
# users - MAC addresses
acl boss        arp    "/etc/squid/acl/users/boss.acl"
acl managers    arp    "/etc/squid/acl/users/managers.acl"
acl admin       arp    "/etc/squid/acl/users/admin.acl"

# users - subnets
acl devs_designers_net    src    "/etc/squid/acl/nets/devs_designers_net.acl"
acl office_workers_net    src    "/etc/squid/acl/nets/office_workers_net.acl"

# require auth for some users
acl developers    proxy_auth    "/etc/squid/acl/users/developers.acl"
acl designers     proxy_auth    "/etc/squid/acl/users/designers.acl"

# sites
acl entertainment_sites      dstdom_regex    "/etc/squid/acl/sites/entertainment.acl"
acl news_sites               dstdom_regex    "/etc/squid/acl/sites/news.acl"
acl windows_updates_sites    dstdom_regex    "/etc/squid/acl/sites/windows_updates.acl"

# files
acl apps_ext              urlpath_regex    "/etc/squid/acl/files/apps.acl"
acl media_ext             urlpath_regex    "/etc/squid/acl/files/media.acl"
acl office_ext            urlpath_regex    "/etc/squid/acl/files/office.acl"
acl windows_update_ext    urlpath_regex    "/etc/squid/acl/files/windows_update.acl"

# time
acl working_hours    time    8:00-16:00
acl working_days     time    M T W H F

##### CUSTOM HTTP_ACCESS #####
### boss ###
# Allow everything
http_access allow boss

### managers ###
# Deny access to entertainment sites during working hours
http_access deny managers entertainment_sites working_hours working_days
# Deny access to entertainment sites during weekends
http_access deny managers entertainment_sites !working_days

http_access allow managers

### designers ###
# Deny access to entertainment sites
http_access deny devs_designers_net designers entertainment_sites
# Deny download of media files
http_access deny devs_designers_net designers media_ext
# Deny download of apps except Windows Update
http_access deny devs_designers_net designers apps_ext !windows_update_ext !windows_updates_sites

http_access allow devs_designers_net designers

### developers ###
# Deny access to entertainment sites
http_access deny devs_designers_net designers entertainment_sites
# Deny access to news sites during working hours
http_access deny devs_designers_net designers news_sites working_hours working_days

http_access allow devs_designers_net developers

### admin ###
# Allow everything during working hours
http_access allow admin working_hours working_days
# Deny access to entertainment sites (outside working hours)
http_access deny admin entertainment_sites

http_access allow admin

### secretary and accountant ###
# Deny access to entertainment sites during working hours
http_access deny office_workers_net entertainment_sites working_hours working_days
# Deny download of files except basic office files
http_access deny office_workers_net !office_ext

http_access allow office_workers_net
\end{lstlisting}

\section{Podsumowanie}
\end{document}
